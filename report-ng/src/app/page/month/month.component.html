<div fxLayout="row" fxLayout.xs="column" fxLayout.sm="column" fxFlex>
  <div fxFlex class="spaced">
    <mat-toolbar color="primary">
      <span fxFlex="calc(100%-300px)" id="month">{{ selectedDate$ | async | moment: 'MMMM YYYY' }}</span>
      <mat-button-toggle-group [(ngModel)]="view">
        <mat-button-toggle value="headline"><mat-icon>view_headline</mat-icon></mat-button-toggle>
        <mat-button-toggle value="stream"><mat-icon>view_stream</mat-icon></mat-button-toggle>
      </mat-button-toggle-group>
      <span *ngIf="user$ | async as user">{{ user.email }}</span>

      <button mat-icon-button [mat-menu-trigger-for]="menu">
        <mat-icon>more_vert</mat-icon>
      </button>
    </mat-toolbar>

    <mat-menu #menu>
      <!-- <button mat-menu-item (click)="initMissingDays()">Initialiser les jours sans heures</button> -->
      <button mat-menu-item (click)="billing()">Générer facture</button>
      <button mat-menu-item (click)="signOut()"><mat-icon>exit_to_app</mat-icon>Logout</button>
    </mat-menu>

    <mat-table id="times" [dataSource]="items$" class="mat-elevation-z8 reports" [ngClass]="{ headline: view == 'headline' }">
      <ng-container matColumnDef="date">
        <mat-header-cell *matHeaderCellDef>Date</mat-header-cell>
        <mat-cell fxFlex="" *matCellDef="let time" (click)="edit(time)" class="clickable">{{ time.date | moment: 'DD dddd' }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="duration">
        <mat-header-cell *matHeaderCellDef></mat-header-cell>
        <mat-cell *matCellDef="let time" fxFlex="100px" (click)="edit(time)" class="clickable">
          {{ time.duration }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="decimal">
        <mat-header-cell *matHeaderCellDef>Total journalier</mat-header-cell>
        <mat-cell *matCellDef="let time" fxFlex="100px" (click)="edit(time)" class="clickable"
          >{{ time.getDuration()?.asHours() | number: '2.2-2' }}
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="['date', 'duration', 'decimal']"></mat-header-row>
      <mat-row *matRowDef="let row; columns: ['date', 'duration', 'decimal']" [class.week]="!row.duration"></mat-row>
    </mat-table>
  </div>
  <div fxFlex class="spaced">
    <mat-card class="mat-elevation-z8 totals">
      <mat-card-title>Totaux</mat-card-title>
      <mat-card-content>
        <div fxLayout="row">
          <div fxFlex id="workDays">{{ workDays$ | async }} jours ouvrés</div>
          <div fxFlex="50px" fxFlexAlign="end" id="total">{{ total$ | async | number: '.2-2' }}</div>
          <div fxFlex="200px">heures</div>
        </div>
        <div fxLayout="row">
          <div fxFlex></div>
          <div fxFlex="50px" fxFlexAlign="end" id="overtime">{{ overtime$ | async | number: '.2-2' }}</div>
          <div fxFlex="200px">heure(s) supplémentaire(s)</div>
        </div>
        <div fxLayout="row">
          <div fxFlex></div>
          <div fxFlex="50px" fxFlexAlign="end" id="finalTotal">{{ finalTotal$ | async | number: '.2-2' }}</div>
          <div fxFlex="200px">heure(s) avec majoration</div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
